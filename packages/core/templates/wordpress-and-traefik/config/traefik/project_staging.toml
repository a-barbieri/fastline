

[http]
  [http.routers]
    [http.routers.%%PROJECT_NAME%%_staging_app]
      entryPoints = ["web"]
      rule = "Host(`%%STAGING_URL_APP%%`)"
      service = "%%PROJECT_NAME%%_staging_app"
      middlewares = ["httpsredirect"]

    [http.routers.%%PROJECT_NAME%%_staging_app-secure]
      entryPoints = ["websecure"]
      rule = "Host(`%%STAGING_URL_APP%%`)"
      service = "%%PROJECT_NAME%%_staging_app"
      [http.routers.%%PROJECT_NAME%%_staging_app-secure.tls]
        certResolver = "mytlschallenge"

    [http.routers.%%PROJECT_NAME%%_staging_admin]
      entryPoints = ["web"]
      rule = "Host(`%%STAGING_URL_ADMIN%%`)"
      service = "%%PROJECT_NAME%%_staging_admin"
      middlewares = ["httpsredirect"]

    [http.routers.%%PROJECT_NAME%%_staging_admin-secure]
      entryPoints = ["websecure"]
      rule = "Host(`%%STAGING_URL_ADMIN%%`)"
      service = "%%PROJECT_NAME%%_staging_admin"
      [http.routers.%%PROJECT_NAME%%_staging_admin-secure.tls]
        certResolver = "mytlschallenge"

  [http.services]
    [http.services.%%PROJECT_NAME%%_staging_app]
      [http.services.%%PROJECT_NAME%%_staging_app.loadBalancer]
        [[http.services.%%PROJECT_NAME%%_staging_app.loadBalancer.servers]]
          port = "3000"
          url = "http://%%PROJECT_NAME%%_staging_app:3000"

    [http.services.%%PROJECT_NAME%%_staging_mariadb]
      [http.services.%%PROJECT_NAME%%_staging_mariadb.loadBalancer]
        [[http.services.%%PROJECT_NAME%%_staging_mariadb.loadBalancer.servers]]
          port = "3306"
          url = "http://%%PROJECT_NAME%%_staging_mariadb:3306"

    [http.services.%%PROJECT_NAME%%_staging_admin]
      [http.services.%%PROJECT_NAME%%_staging_admin.loadBalancer]
        [[http.services.%%PROJECT_NAME%%_staging_admin.loadBalancer.servers]]
          port = "80"
          url = "http://%%PROJECT_NAME%%_staging_admin:80"

    [http.services.%%PROJECT_NAME%%_staging_adminer]
      [http.services.%%PROJECT_NAME%%_staging_adminer.loadBalancer]
        [[http.services.%%PROJECT_NAME%%_staging_adminer.loadBalancer.servers]]
          port = "8080"
          url = "http://%%PROJECT_NAME%%_staging_adminer:8080"

  [http.middlewares]
    [http.middlewares.httpsredirect.redirectScheme]
      scheme = "https"

    [http.middlewares.basicauth.basicAuth]
      users = [
        "testuser:$apr1$7i5qo5wa$NBbY9salk11T3chQ4aeZD.",
      ]